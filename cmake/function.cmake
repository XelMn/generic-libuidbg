
FUNCTION(X_ADD_INCLUDE_LINK)
    SET(oneValueArgs SOURCE DESTINATION TARGET)
    SET(multiValueArgs HEADER_LIST)
    CMAKE_PARSE_ARGUMENTS("${prefix}" "${options}" "${oneValueArgs}" "${multiValueArgs}" ${ARGN})
    FOREACH (HEADER ${_HEADER_LIST})
        GET_FILENAME_COMPONENT(HEADER_REAL_PATH ${HEADER} REALPATH)
        FILE(RELATIVE_PATH HEADER_SOURCE_RELATIVE_PATH ${_SOURCE} ${HEADER_REAL_PATH})
        SET(HEADER_LINK_FILE ${_DESTINATION}/${_TARGET}/${HEADER_SOURCE_RELATIVE_PATH})
        GET_FILENAME_COMPONENT(HEADER_LINK_FILE_PATH ${HEADER_LINK_FILE} DIRECTORY)
        FILE(RELATIVE_PATH HEADER_RELATIVE_PATH ${HEADER_LINK_FILE_PATH} ${HEADER_REAL_PATH})
        FILE(WRITE ${HEADER_LINK_FILE} "#include \"${HEADER_RELATIVE_PATH}\"")
    ENDFOREACH()
ENDFUNCTION()


FUNCTION(X_ADDTASK_DEPLOYQT)
    SET(oneValueArgs TARGET)
    CMAKE_PARSE_ARGUMENTS("${prefix}" "${options}" "${oneValueArgs}" "${multiValueArgs}" ${ARGN})
    LIST(FIND TASKLIST_DEPLOYQT ${_TARGET} RESULT)
    IF (RESULT EQUAL -1)
        LIST(APPEND TASKLIST_DEPLOYQT ${_TARGET})
        SET(TASKLIST_DEPLOYQT ${TASKLIST_DEPLOYQT} CACHE INTERNAL "")
    ENDIF()
ENDFUNCTION()


FUNCTION(X_ADD_TARGET_DEPLOYQT)
    FIND_PROGRAM(DEPLOYQT NAMES windeployqt deployqt)
    IF (DEPLOYQT)
        SET(TASKLIST ${TASKLIST_DEPLOYQT})
        LIST(TRANSFORM TASKLIST PREPEND "\"\$\<TARGET_FILE:")
        LIST(TRANSFORM TASKLIST APPEND "\>\"")
        LIST(JOIN TASKLIST " " TARGET_PATH_LIST)
        LIST(GET TASKLIST_DEPLOYQT 0 FRONT)
        IF (FRONT)
            SET(PLUGIN_OPTION "--plugindir \"$<TARGET_FILE_DIR:${FRONT}>/QtPlugins\"")
        ENDIF()
        ADD_CUSTOM_TARGET(deployqt
            COMMAND ${DEPLOYQT} $<$<CONFIG:DEBUG>:--debug> --force --no-translations ${TARGET_PATH_LIST} ${PLUGIN_OPTION}
        )
    ENDIF()
ENDFUNCTION()